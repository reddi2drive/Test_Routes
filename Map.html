<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reddi2Drive – Redditch Test Routes</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

h2 {
  padding: 10px;
  margin: 0;
  background: #111;
  color: #fff;
}

.controls {
  padding: 10px;
  background: #f4f4f4;
  border-bottom: 1px solid #ddd;
}

#map {
  height: calc(100vh - 120px);
  width: 100%;
}
</style>
</head>

<body>

<h2>Reddi2Drive – Redditch Test Routes</h2>

<div class="controls">
  <label><input type="checkbox" data-route="oakenshaw_route.gpx"> Oakenshaw Route</label><br>
  <label><input type="checkbox" data-route="sainsburys_route.gpx"> Sainsbury’s Route</label><br>
  <label><input type="checkbox" data-route="towncentre_route.gpx"> Town Centre Route</label>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-gpx/gpx.min.js"></script>

<script>
const map = L.map('map');

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

// Load Redditch coverage box
fetch('redditch.box')
  .then(r => r.text())
  .then(t => {
    const [swLat, swLng, neLat, neLng] = t.split(',').map(Number);
    const bounds = [[swLat, swLng],[neLat, neLng]];

    L.rectangle(bounds, {
      color: '#ff0000',
      weight: 2,
      fillOpacity: 0.05
    }).addTo(map);

    map.fitBounds(bounds);
  });

// GPX routes toggle system
const routes = {};

document.querySelectorAll('input[type=checkbox]').forEach(cb => {
  cb.addEventListener('change', function() {
    const file = this.dataset.route;

    if (this.checked) {
      routes[file] = new L.GPX('routes/' + file, {
        async: true,
        polyline_options: {
          weight: 4,
          color: '#0066ff'
        }
      }).addTo(map);
    } else {
      map.removeLayer(routes[file]);
    }
  });
});
</script>

</body>
</html>